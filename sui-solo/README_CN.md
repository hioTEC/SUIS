<div align="center">

# ğŸš€ SUI Solo

**åˆ†å¸ƒå¼ä»£ç†é›†ç¾¤ç®¡ç†ç³»ç»Ÿ**

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Docker](https://img.shields.io/badge/Docker-Required-blue?logo=docker)](https://www.docker.com/)
[![Python](https://img.shields.io/badge/Python-3.11+-green?logo=python)](https://www.python.org/)
[![Security](https://img.shields.io/badge/Security-Hardened-green)](SECURITY.md)

[English](README.md) | [ç®€ä½“ä¸­æ–‡](README_CN.md)

</div>

---

## âš ï¸ å®‰è£…å‰å¿…è¯»

> **é‡è¦ï¼šå®‰è£…å‰å¿…é¡»å…ˆé…ç½®å¥½ DNSï¼**
> 
> Caddy éœ€è¦éªŒè¯åŸŸåæ‰€æœ‰æƒæ‰èƒ½ç­¾å‘ SSL è¯ä¹¦ã€‚
> å¦‚æœ DNS æœªæŒ‡å‘æœåŠ¡å™¨ï¼Œå®‰è£…å°†å¤±è´¥ã€‚

```bash
# éªŒè¯ DNS æ˜¯å¦ç”Ÿæ•ˆï¼š
dig +short panel.example.com  # åº”è¿”å›ä½ çš„æœåŠ¡å™¨ IP
dig +short node1.example.com  # åº”è¿”å›ä½ çš„æœåŠ¡å™¨ IP
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Docker 20.10+ (å« Docker Compose)
- **Master å¿…é¡»æœ‰åŸŸå** (HTTPS å¿…éœ€)
- æ¯ä¸ª Node éœ€è¦åŸŸå
- ç«¯å£: 80, 443 (Master å’Œ Node), 53 (ä»… Node)
- **DNS å·²é…ç½®å¹¶ç”Ÿæ•ˆ**

### å®‰è£…ä¸»æ§ (Master)

```bash
git clone https://github.com/yourusername/sui-solo.git
cd sui-solo
sudo ./install.sh --master
```

å®‰è£…æ—¶éœ€è¦è¾“å…¥:
1. **Master åŸŸå** (å¦‚ `panel.example.com`)
2. **é‚®ç®±** ç”¨äº SSL è¯ä¹¦

> ğŸ“ **åŠ¡å¿…ä¿å­˜å®‰è£…åæ˜¾ç¤ºçš„ Cluster Secretï¼**

### å®‰è£…èŠ‚ç‚¹ (Node)

```bash
sudo ./install.sh --node
# è¾“å…¥: Cluster Secretã€èŠ‚ç‚¹åŸŸåã€é‚®ç®±
```

### åœ¨ä¸»æ§æ·»åŠ èŠ‚ç‚¹

æ‰“å¼€ `https://ä½ çš„ä¸»æ§åŸŸå` â†’ ç‚¹å‡» **"+ Add Node"**

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### çºµæ·±é˜²å¾¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å®‰å…¨å±‚çº§                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬1å±‚: HTTPS/TLS          - å…¨é“¾è·¯åŠ å¯†                      â”‚
â”‚  ç¬¬2å±‚: éšè— API è·¯å¾„       - SHA256(SALT:token)[:16]        â”‚
â”‚  ç¬¬3å±‚: Token è®¤è¯          - X-SUI-Token è¯·æ±‚å¤´             â”‚
â”‚  ç¬¬4å±‚: é¢‘ç‡é™åˆ¶            - æ¯ IP æ¯åˆ†é’Ÿ 5 æ¬¡è®¤è¯å°è¯•       â”‚
â”‚  ç¬¬5å±‚: è¾“å…¥æ¸…æ´—            - ç™½åå•éªŒè¯                      â”‚
â”‚  ç¬¬6å±‚: å‘½ä»¤ç™½åå•          - ä»…å…è®¸ç‰¹å®š docker å‘½ä»¤          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é¢‘ç‡é™åˆ¶

| ç«¯ç‚¹ç±»å‹ | é™åˆ¶ | æ—¶é—´çª—å£ |
|---------|------|---------|
| æ™®é€š API | 30 æ¬¡ | 60 ç§’ |
| æ•æ„Ÿæ“ä½œ | 5 æ¬¡ | 60 ç§’ |
| è§¦å‘é™åˆ¶å | å°ç¦ | 120 ç§’ |

### è¾“å…¥æ¸…æ´—

- åŸŸå: æ­£åˆ™ç™½åå• `^[a-zA-Z0-9][a-zA-Z0-9\-\.]*$`
- æœåŠ¡: ç™½åå• `{singbox, adguard, caddy}`
- èŠ‚ç‚¹ ID: åå…­è¿›åˆ¶æ ¼å¼ `^[a-f0-9]{8}$`
- å¸¸é‡æ—¶é—´ Token æ¯”è¾ƒ (é˜²æ­¢æ—¶åºæ”»å‡»)

---

## âš ï¸ å®‰å…¨è­¦å‘Š

### Docker Socket è®¿é—®

> **âš ï¸ ä¸­ç­‰é£é™©**

Agent å®¹å™¨éœ€è¦ Docker socket è®¿é—®æƒé™æ¥é‡å¯æœåŠ¡ã€‚
è¿™ä¼šæˆäºˆè¾ƒé«˜æƒé™ã€‚å·²å®æ–½çš„ç¼“è§£æªæ–½ï¼š

- âœ… å‘½ä»¤ç™½åå• (ä»… `restart`, `inspect`, `logs`)
- âœ… å®¹å™¨åç™½åå• (ä»… `sui-*`)
- âœ… åªè¯»æŒ‚è½½ socket
- âœ… ç§»é™¤ä¸å¿…è¦çš„ capabilities
- âœ… `no-new-privileges` å®‰å…¨é€‰é¡¹

**å¦‚éœ€æœ€é«˜å®‰å…¨æ€§**ï¼Œå»ºè®®ï¼š
1. ä½¿ç”¨ Sing-box çš„è‡ªåŠ¨é‡è½½åŠŸèƒ½ä»£æ›¿é‡å¯
2. è¿è¡Œç‹¬ç«‹çš„æœ€å°æƒé™ sidecar å®¹å™¨

### å®‰å…¨å»ºè®®

```bash
# 1. ä½¿ç”¨å¼ºéšæœº Cluster Secret (è‡ªåŠ¨ç”Ÿæˆ)
# 2. ä¿æŒ Docker å’Œé•œåƒæ›´æ–°
# 3. ç›‘æ§æ—¥å¿—ä¸­çš„å¯ç–‘æ´»åŠ¨
docker logs sui-agent | grep -i "auth failed"

# 4. ä½¿ç”¨é˜²ç«å¢™é™åˆ¶è®¿é—®
ufw allow from ä½ çš„IP to any port 443
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
sui-solo/
â”œâ”€â”€ install.sh              # äº¤äº’å¼å®‰è£…è„šæœ¬
â”œâ”€â”€ README.md / README_CN.md
â”œâ”€â”€ master/
â”‚   â”œâ”€â”€ docker-compose.yml  # Caddy (ç½‘å…³) + Flask (å†…éƒ¨)
â”‚   â”œâ”€â”€ app.py              # é¢‘ç‡é™åˆ¶ã€è¾“å…¥æ¸…æ´—
â”‚   â””â”€â”€ config/caddy/       # ç”Ÿæˆçš„ Caddyfile (å« HSTS)
â””â”€â”€ node/
    â”œâ”€â”€ docker-compose.yml  # å®‰å…¨åŠ å›ºçš„å®¹å™¨é…ç½®
    â”œâ”€â”€ agent.py            # å‘½ä»¤ç™½åå•ã€é¢‘ç‡é™åˆ¶
    â””â”€â”€ templates/          # Caddyfile æ¨¡æ¿
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| SSL è¯ä¹¦é”™è¯¯ | éªŒè¯ DNS: `dig +short ä½ çš„åŸŸå` |
| "Rate limit exceeded" | ç­‰å¾… 60-120 ç§’ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ”»å‡» |
| Token é”™è¯¯ | æ£€æŸ¥ä¸¤ç«¯ `.env` ä¸­çš„å¯†é’¥æ˜¯å¦ä¸€è‡´ |
| ç«¯å£è¢«å ç”¨ | `sudo lsof -i :80` æ‰¾å‡ºå ç”¨è¿›ç¨‹ |

### æŸ¥çœ‹å®‰å…¨æ—¥å¿—

```bash
# æ£€æŸ¥è®¤è¯å¤±è´¥
docker logs sui-agent 2>&1 | grep -i "auth\|rate\|blocked"

# æ£€æŸ¥ Caddy è®¿é—®æ—¥å¿—
docker exec sui-caddy cat /var/log/caddy/access.log | tail -20
```

---

## âš ï¸ å…è´£å£°æ˜

æœ¬é¡¹ç›®ä»…ä¾›**æ•™è‚²å’ŒæŠ€æœ¯ç ”ç©¶ç›®çš„**ã€‚ç”¨æˆ·å¿…é¡»éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„ã€‚ä½œè€…ä¸å¯¹ä»»ä½•æ»¥ç”¨è¡Œä¸ºè´Ÿè´£ã€‚

---

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE)

---

<div align="center">
Made with â¤ï¸ for the open source community
</div>
