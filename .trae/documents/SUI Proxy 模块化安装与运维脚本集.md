### 计划：SUI Proxy 模块化安装与运维脚本集

#### 1. 核心安装脚本 (`install.sh`)
- **功能**: 作为主入口，引导用户完成整个安装过程。
- **特性**:
    - **交互式配置**: 自动检测并安装依赖，引导用户输入域名、邮箱和部署模式 (`master`, `node`, `both`)。
    - **组件化安装**: 自动安装和配置 Caddy 与 Singbox。
    - **动态配置生成**: 根据用户输入，动态创建所有服务（Singbox, Caddy, Master, Node）的配置文件。
    - **最新代码拉取**: 在安装时，始终从远程仓库拉取最新的源代码，确保部署的是最新版本。
    - **服务自启动**: 自动创建并启用 `systemd` 服务，确保服务开机自启。

#### 2. TLS 证书管理脚本 (`cert-renewal.sh`)
- **功能**: 一个独立的、功能完善的证书管理工具。
- **特性**:
    - **状态检查**: 检查当前证书的有效期。
    - **手动/自动续期**: 支持手动触发续期，并可配置为 `cron` 任务或 `systemd timer` 实现自动续期。
    - **类型切换**: 允许在 Let's Encrypt、自签名证书和自定义证书之间切换。
    - **HTTPS 测试**: 提供连接测试功能，验证证书配置是否正确。

#### 3. 系统诊断与修复脚本 (`/opt/sui-proxy/scripts/diagnose-fix.sh`)
- **功能**: 当遇到“页面无法打开”等问题时，用于快速诊断和修复。
- **特性**:
    - **全面检查**: 自动检查服务状态、端口监听、DNS解析、防火墙规则和证书有效性。
    - **自动修复**: 交互式地修复常见问题，如终止冲突进程、强制续期证书等。
    - **生成报告**: 输出一份详细的诊断报告，帮助定位问题。

#### 4. Bcrypt 生成修复脚本 (`/opt/sui-proxy/scripts/fix-bcrypt.sh`)
- **功能**: 确保管理员密码的 bcrypt 哈希能够被可靠生成。
- **特性**:
    - **容器等待**: 在执行前，会等待关键的 `master` 容器准备就绪。
    - **多重回退**: 优先使用 Python `bcrypt` 库；如果失败，则尝试使用 `Node.js`；如果仍然失败，则生成一个安全的临时密码，避免安装中断。

#### 5. 核心服务配置文件
- **/etc/caddy/Caddyfile**:
    - 负责处理所有 `HTTP` 流量，并将其重定向到 `HTTPS`。
    - 作为 `Singbox` 的后端，为 `master` 面板提供服务。
    - 自动管理 `*.your-domain.com` 的通配符证书。
- **/etc/singbox/config.json**:
    - 作为系统的唯一入口，监听 `443` 端口。
    - 负责 `TLS` 终止，使用与 Caddy 同步的证书。
    - 根据 `SNI` (域名)进行智能路由：
        - `node.your-domain.com` 的流量转发给 VLESS 代理后端。
        - 其他所有流量（如 `master.your-domain.com`）则转发给 Caddy 处理。

执行此计划将为您部署一套健壮、易于维护的代理服务系统。如果您同意这个计划，我将提供所有文件的完整代码，以便您开始部署。