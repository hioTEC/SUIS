<div align="center">

# ğŸš€ SUI Solo

**åˆ†å¸ƒå¼ä»£ç†é›†ç¾¤ç®¡ç†ç³»ç»Ÿ**

ä¸€é”®éƒ¨ç½²å’Œç®¡ç† Sing-box + AdGuard Home èŠ‚ç‚¹

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Docker](https://img.shields.io/badge/Docker-Required-blue?logo=docker)](https://www.docker.com/)
[![Python](https://img.shields.io/badge/Python-3.11+-green?logo=python)](https://www.python.org/)
[![Security](https://img.shields.io/badge/Security-Hardened-green.svg)](#-å®‰å…¨ç‰¹æ€§)

[English](README.md) | [ç®€ä½“ä¸­æ–‡](README_CN.md)

</div>

---

## âš ï¸ å®‰è£…å‰å¿…è¯»

> **å®‰è£…å‰å¿…é¡»å…ˆé…ç½®å¥½ DNSï¼**
> 
> Caddy éœ€è¦éªŒè¯åŸŸåæ‰€æœ‰æƒæ‰èƒ½ç­¾å‘ SSL è¯ä¹¦ã€‚
> å¦‚æœ DNS æœªæŒ‡å‘æœåŠ¡å™¨ï¼Œå®‰è£…å°†å¤±è´¥ã€‚

```bash
# éªŒè¯ DNS æ˜¯å¦ç”Ÿæ•ˆï¼š
dig +short panel.example.com  # åº”è¿”å›ä½ çš„æœåŠ¡å™¨ IP
dig +short node1.example.com
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Docker 20.10+ (å« Docker Compose)
- **Master å’Œæ¯ä¸ª Node éƒ½éœ€è¦åŸŸå** (HTTPS å¿…éœ€)
- ç«¯å£: 80, 443 (Master å’Œ Node), 53 (ä»… Node)
- **DNS å·²é…ç½®å¹¶ç”Ÿæ•ˆ**

### å®‰è£…ä¸»æ§ (Master)

```bash
git clone https://github.com/pjonix/SUIS.git
cd SUIS
sudo ./install.sh --master
```

å®‰è£…æ—¶éœ€è¦è¾“å…¥:
1. **Master åŸŸå** (å¦‚ `panel.example.com`)
2. **é‚®ç®±** ç”¨äº SSL è¯ä¹¦

> ğŸ“ **åŠ¡å¿…ä¿å­˜å®‰è£…åæ˜¾ç¤ºçš„ Cluster Secretï¼**

### å®‰è£…èŠ‚ç‚¹ (Node)

```bash
sudo ./install.sh --node
# è¾“å…¥: Cluster Secretã€èŠ‚ç‚¹åŸŸåã€é‚®ç®±
```

### åœ¨ä¸»æ§æ·»åŠ èŠ‚ç‚¹

æ‰“å¼€ `https://ä½ çš„ä¸»æ§åŸŸå` â†’ ç‚¹å‡» **"+ Add Node"**

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### çºµæ·±é˜²å¾¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å®‰å…¨å±‚çº§                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬1å±‚: HTTPS/TLS          - å…¨é“¾è·¯åŠ å¯†                      â”‚
â”‚  ç¬¬2å±‚: éšè— API è·¯å¾„       - SHA256(SALT:token)[:16]        â”‚
â”‚  ç¬¬3å±‚: Token è®¤è¯          - X-SUI-Token è¯·æ±‚å¤´             â”‚
â”‚  ç¬¬4å±‚: é¢‘ç‡é™åˆ¶            - æ¯ IP æ¯åˆ†é’Ÿ 5 æ¬¡è®¤è¯å°è¯•       â”‚
â”‚  ç¬¬5å±‚: è¾“å…¥æ¸…æ´—            - ç™½åå•éªŒè¯                      â”‚
â”‚  ç¬¬6å±‚: å‘½ä»¤ç™½åå•          - ä»…å…è®¸ç‰¹å®š docker å‘½ä»¤          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é¢‘ç‡é™åˆ¶

| ç«¯ç‚¹ç±»å‹ | é™åˆ¶ | æ—¶é—´çª—å£ |
|---------|------|---------|
| æ™®é€š API | 30 æ¬¡ | 60 ç§’ |
| æ•æ„Ÿæ“ä½œ | 5 æ¬¡ | 60 ç§’ |
| è§¦å‘é™åˆ¶å | å°ç¦ | 120 ç§’ |

### åŠ ç›éšè—è·¯å¾„

```python
SALT = "SUI_Solo_Secured_2024"

def get_hidden_path(token: str) -> str:
    combined = f"{SALT}:{token}"
    return hashlib.sha256(combined.encode()).hexdigest()[:16]

# API: /{16ä½å“ˆå¸Œ}/api/v1/status
```

**è®¾è®¡åŸç†ï¼š**
- **ç¡®å®šæ€§**: ç›¸åŒ Token = ä¸»æ§å’ŒèŠ‚ç‚¹è®¡ç®—å‡ºç›¸åŒè·¯å¾„
- **é˜²æ‰«æ**: æ²¡æœ‰ Token æ— æ³•æ¨ç®— URL
- **çºµæ·±é˜²å¾¡**: Caddy ä»…æ”¾è¡Œéšè—è·¯å¾„ï¼Œå…¶ä»–è¿”å›ä¼ªè£…é¡µ

---

## ğŸ—ï¸ æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸»æ§ MASTER (ä»… HTTPS)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚   Caddy     â”‚ â”€â”€â”€â–¶ â”‚  Flask App  â”‚                       â”‚
â”‚  â”‚  (ç½‘å…³)     â”‚      â”‚  (å†…éƒ¨)     â”‚                       â”‚
â”‚  â”‚  :80/:443   â”‚      â”‚    :5000    â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    HTTPS + Token è®¤è¯
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      èŠ‚ç‚¹ NODE (ä»… HTTPS)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚   Caddy     â”‚ â”€â”€â”€â–¶ â”‚   Agent     â”‚ â”€â”€â”€â–¶ Sing-box        â”‚
â”‚  â”‚  (ç½‘å…³)     â”‚      â”‚  (éšè—è·¯å¾„) â”‚ â”€â”€â”€â–¶ AdGuard         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
sui-solo/
â”œâ”€â”€ install.sh              # äº¤äº’å¼å®‰è£…è„šæœ¬
â”œâ”€â”€ README.md / README_CN.md
â”œâ”€â”€ LICENSE / .gitignore
â”œâ”€â”€ master/
â”‚   â”œâ”€â”€ docker-compose.yml  # Caddy (ç½‘å…³) + Flask (å†…éƒ¨)
â”‚   â”œâ”€â”€ app.py              # é¢‘ç‡é™åˆ¶ã€è¾“å…¥æ¸…æ´—
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ templates/index.html
â””â”€â”€ node/
    â”œâ”€â”€ docker-compose.yml  # å®‰å…¨åŠ å›ºçš„å®¹å™¨é…ç½®
    â”œâ”€â”€ agent.py            # å‘½ä»¤ç™½åå•ã€é¢‘ç‡é™åˆ¶
    â”œâ”€â”€ Dockerfile
    â””â”€â”€ templates/Caddyfile.template
```

---

## âš ï¸ å®‰å…¨è­¦å‘Š

### Docker Socket è®¿é—®

> **âš ï¸ ä¸­ç­‰é£é™©**

Agent å®¹å™¨éœ€è¦ Docker socket è®¿é—®æƒé™æ¥é‡å¯æœåŠ¡ã€‚å·²å®æ–½çš„ç¼“è§£æªæ–½ï¼š

- âœ… å‘½ä»¤ç™½åå• (ä»… `restart`, `inspect`, `logs`)
- âœ… å®¹å™¨åç™½åå• (ä»… `sui-*`)
- âœ… åªè¯»æŒ‚è½½ socket
- âœ… ç§»é™¤ä¸å¿…è¦çš„ capabilities
- âœ… `no-new-privileges` å®‰å…¨é€‰é¡¹

---

## ğŸ”§ å¸¸è§é—®é¢˜

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| SSL è¯ä¹¦é”™è¯¯ | éªŒè¯ DNS: `dig +short ä½ çš„åŸŸå` |
| "Rate limit exceeded" | ç­‰å¾… 60-120 ç§’ |
| Token é”™è¯¯ | æ£€æŸ¥ä¸¤ç«¯ `.env` ä¸­çš„å¯†é’¥æ˜¯å¦ä¸€è‡´ |
| ç«¯å£è¢«å ç”¨ | `sudo lsof -i :80` æ‰¾å‡ºå ç”¨è¿›ç¨‹ |

### æŸ¥çœ‹æ—¥å¿—

```bash
# ä¸»æ§æ—¥å¿—
cd /opt/sui-solo/master && docker compose logs -f

# èŠ‚ç‚¹æ—¥å¿—
cd /opt/sui-solo/node && docker compose logs -f

# æ£€æŸ¥è®¤è¯å¤±è´¥
docker logs sui-agent 2>&1 | grep -i "auth\|rate"
```

---

## ğŸ“¡ API å‚è€ƒ

### è®¤è¯

æ‰€æœ‰ API è¯·æ±‚éœ€è¦:
- è·¯å¾„: `/{PATH_PREFIX}/api/v1/...`
- è¯·æ±‚å¤´: `X-SUI-Token: <CLUSTER_SECRET>`

### ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | é¢‘ç‡é™åˆ¶ |
|------|------|---------|
| `/status` | GET | 30/åˆ†é’Ÿ |
| `/services` | GET | 30/åˆ†é’Ÿ |
| `/restart/<service>` | POST | 5/åˆ†é’Ÿ |
| `/config/<service>` | GET/POST | 5/åˆ†é’Ÿ (POST) |
| `/logs/<service>` | GET | 30/åˆ†é’Ÿ |

---

## âš ï¸ å…è´£å£°æ˜

æœ¬é¡¹ç›®ä»…ä¾›**æ•™è‚²å’ŒæŠ€æœ¯ç ”ç©¶ç›®çš„**ã€‚ç”¨æˆ·å¿…é¡»éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„ã€‚ä½œè€…ä¸å¯¹ä»»ä½•æ»¥ç”¨è¡Œä¸ºè´Ÿè´£ã€‚

---

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE)

---

<div align="center">
Made with â¤ï¸ for the open source community
</div>
